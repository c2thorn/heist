<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Project CLOCKWORK</title>
  <style>
    html,
    body {
      background-color: #000 !important;
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <!-- SHOP / SAFEHOUSE SCREEN -->
  <div id="shop-screen" style="display:none;">
    <!-- Header removed, stats moved to Global HUD -->

    <div id="shop-columns">
      <!-- SERVICES (Left) -->
      <div class="shop-column">
        <h2>SERVICES</h2>
        <div id="services-list">
          <div class="shop-item">
            <div class="shop-item-text">
              <h3>BUY INTEL</h3>
              <p>Get 5 Intel to help scout.</p>
            </div>
            <button id="buy-intel-btn">BUY ($200)</button>
          </div>
          <div class="shop-item">
            <div class="shop-item-text">
              <h3>LAUNDER MONEY</h3>
              <p>Reduce Heat by 20%.</p>
            </div>
            <button id="launder-btn">PAY ($500)</button>
          </div>
        </div>
      </div>

      <!-- RECRUITMENT (Middle) -->
      <div class="shop-column">
        <h2>RECRUITMENT</h2>
        <div id="recruit-list"></div>
      </div>

      <!-- BLACK MARKET (Right) -->
      <div class="shop-column">
        <h2>BLACK MARKET</h2>
        <div id="gear-list"></div>
      </div>
    </div>
  </div>

  <!-- GAME RESULTS MODAL -->
  <div id="game-results-screen" style="display:none;">
    <div id="results-modal">
      <h1 id="results-title">HEIST SUCCESSFUL</h1>
      <p id="results-msg"></p>
      <button id="results-btn">GO TO SAFEHOUSE</button>
    </div>
  </div>

  <!-- UNIFIED GAME LAYER -->
  <div id="game-container">
    <div id="game-map">
      <!-- New Tile Grid Canvas -->
      <canvas id="tile-grid-canvas"></canvas>
      <!-- Legacy Node Map (will be hidden when grid is active) -->
      <svg id="map-connections" xmlns="http://www.w3.org/2000/svg"></svg>
      <div id="map-nodes"></div>
      <div id="crew-token" class="hidden"></div>
    </div>
  </div>

  <div id="hud-layer">
    <div id="hud-top">
      <div id="resource-hud">
        <!-- LEFT: Resources -->
        <div class="hud-group">
          <div class="res-item" id="day-display">DAY: 1</div>
          <div class="res-item" id="cash-display">CASH: $1500</div>
          <div class="res-item" id="intel-display">INTEL: 0</div>
        </div>

        <!-- CENTER: Tabs -->
        <div id="view-tabs">
          <button id="btn-view-map" class="active">TACTICAL MAP</button>
          <button id="btn-view-shop">SAFEHOUSE</button>
        </div>

        <!-- RIGHT: Heat -->
        <div class="hud-group right-align">
          <div id="heat-bar-container">
            <label id="heat-label">SYSTEM HEAT: 0%</label>
            <div id="heat-bar-bg">
              <div id="heat-bar-fill"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ACTION PANEL (Floating Right) -->
    <div id="action-panel">
      <button id="execute-btn" disabled>EXECUTE HEIST</button>

    </div>

    <div id="hud-center">
      <div id="event-log"></div>
    </div>

    <!-- COMMAND DECK (BOTTOM) -->
    <div id="command-deck">
      <div class="deck-section" id="active-section">
        <div class="section-label">ACTIVE STACK</div>
        <div id="active-list-panel" class="deck-list"></div>
      </div>
      <div class="deck-divider"></div>
      <div id="roster-section" class="deck-section">
        <div class="section-label">RESERVES</div>
        <div id="roster-list-panel" class="deck-list"></div>
      </div>
      <div class="deck-divider"></div>
      <div id="stash-section" class="deck-section">
        <div class="section-label">STASH</div>
        <div id="stash-list-panel" class="deck-list"></div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/renderer.js"></script>
  <script>
    window.addEventListener('gameStateUpdated', (e) => {
      const executeBtn = document.getElementById('execute-btn');
      if (!executeBtn) return;
      const { isCompletable } = e.detail;
      executeBtn.disabled = !isCompletable;
      if (isCompletable) executeBtn.classList.add('ready');
      else executeBtn.classList.remove('ready');
    });

    document.getElementById('execute-btn')?.addEventListener('click', () => {
      window.dispatchEvent(new CustomEvent('startHeist'));
    });

    window.addEventListener('heistEventLog', (e) => {
      const log = document.getElementById('event-log');
      if (!log) return;
      const entry = document.createElement('div');
      entry.className = `log-entry ${e.detail.outcome.toLowerCase()}`;
      entry.innerText = e.detail.message;
      log.prepend(entry);
    });
  </script>
</body>

</html>